# 2 DNS查询
**DNS**：Domain Name System，域名系统。因特网上作为域名和IP地址相互映射的一个分布式数据库，能使用户更方便的访问互联网，而不用记住能够直接被机器读取的IP。通过主机名（如www.baidu.com)，最终得到该主机名对应的IP地址(如167.23.10.2)的过程叫————域名解析（或主机名解析）


**DNS域名称空间的组织方式**

按其功能命名空间中用五个类别来描述DNS域名称：
1. ？？？ 根域：DNS域名中使用时，规定由尾部句点（.）来指定名称处于根或更高级别的域层次结构，如单个句点（.）或句点用于末尾的名称？
2. 顶级域：某个国家/地区或组织使用的名称的类型名称，如.com
3. 第二层域：个人或组织在Internet上使用的注册名称，如qq.com
4. 子域：已注册的二级域名派生的域名，通俗的说就是网站名，如www.qq.com
5. 主机名：通常，DNS域名最左侧的标签标识网络上的特定计算机，如h1.www.qq.com

## DNS负载均衡
当一个网站有足够多用户时，假如每次请求的资源都位于同一台机器上，机器随时可能崩掉，处理办法就是用DNS负载均衡技术。

原理：在DNS服务器中为同一个主机名配置多个IP地址。在应答DNS查询时，DNS对每个查询将以DNS文件中主机记录的IP地址按顺序返回不同的解析结果，将客户端的访问引导到不同的机器上去，使得不同客户端访问不同的服务器，从而达到负载均衡的母的。例如可以根据每台机器的负载量，该机器离用户地理位置的距离等。

（见根域名服务器图）

基本步骤：浏览器缓存-->操作系统缓存-->路由器缓存-->ISP DNS缓存-->根域名服务器
1. 浏览器会先检查是否在缓存中，没有则调用系统库函数进行查询
2. 操作系统也有自己的DNS缓存，但在这之前，会检查域名是否存在本地的Hosts文件里，没有则向DNS服务器发送查询请求
3. 路由器也有自己的缓存
4. ISP DNS就是在客户端电脑上设置的首选DNS服务器，在大多数情况下都会有缓存
5. 根域名服务器查询：在前面步骤都没有缓存的情况下，本地DNS服务器会将请求转发到互联网上的根域


1. 一般来说，浏览器会首先查看本地硬盘的hosts文件，看看其中有没有和该域名对应的规则，有的话就直接用hosts文件里的IP地址

2. 如果本地hosts没有找到对应的ip，浏览器发送一个DNS请求到本地DNS服务器。本地DNS服务器一般是你的网络接入服务商提供，如中国电信，中国移动

3. DNS请求到本地DNS服务器后，本地DNS服务器会先查询它的缓存记录，如果缓存记录中有此条记录，则直接返回结果，此过程是递归的方式进行查询。如果没有，本地DNS服务器还要向DNS根服务器进行查询

4. 根DNS服务器没有记录具体的域名和IP地址的对应关系，而是告诉本地DNS服务器，你可以到域服务器上去继续查询，并给出域服务器的地址。这种过程是迭代的过程。

5. 本地DNS服务器继续向域服务器发出请求，如请求的对象是.com域服务器，.com域服务器收到请求后，也不直接返回域名和IP地址的对应关系，而是告诉本地DNS服务器，你的域名的解析服务器的地址

6. 最后，本地DNS服务器向域名的解析服务器发出请求，这时就能收到一个域名和IP的对应关系。本地DNS服务器不仅把IP地址返回给用户电脑，还要把这个对应关系保存在缓存中，以备下次别的用户查询时可以直接返回结果，加快网络访问


需要注意：
1. 递归解析方式：一路查下去中间不返回，得到最终结果才返回信息（浏览器到本地DNS服务器的过程）
当局部DNS服务器不能回答客户机的DNS查询时，它需要向其他DNS服务器进行查询。递归方式，就是局部DNS服务器自己负责向其他DNS服务器进行查询，一般是先向该域名的根域服务器进行查询，再由根据名服务器一级级向下查询。最后得到的查询结果返回给局部DNS服务器，再由局部DNS服务器返回给客户端。

2. 迭代方式，就是本地DNS服务器到根域名服务器查询的方式

当局部DNS服务器不能回答客户机的DNS查询时，也可以通过迭代查询的方式。局部DNS服务器不是自己向其他DNS服务器进行查询，而是把能解析该域名的其他DNS服务器的IP地址返回给客户端DNS程序，客户端DNS程序再继续向这些DNS服务器进行查询，直到得到查询结果为止。

即帮你找到相关的服务器，而不会帮你去查（请求）。如告诉你baidu.com的服务器IP地址在192.168.4.5这里，你自己去查吧。

### 什么是DNS劫持
### 前端DNS-prefetch优化
DNS 是什么-- Domain Name System，域名系统，作为域名和IP地址相互映射的一个分布式数据库。
DNS Prefetching
浏览器根据自定义的规则，提前去解析后面可能用到的域名，来加速网站的访问速度。简单来讲就是提前解析域名，以免延迟。

使用方式
```html
<link rel="dns-prefetch" href="//wq.test.com">
```
这个功能有个默认加载条件，所有的a标签的href都会自动去启用DNS Prefetching，也就是说，你网页的a标签href带的域名，是不需要在head里面加上link手动设置的。但a标签的默认启动在HTTPS不起作用。

这时要使用 meta里面http-equiv来强制启动功能。

```html
<meta http-equiv="x-dns-prefetch-control" content="on">
```

- DNS Prefetching是提前加载域名解析的，省去了解析时间。a标签的href是可以在chrome,firefox包括高版本的IE，但是在HTTPS下面不起作用，需要meta来强制开启功能
- 这是DNS的提前解析，并不是css，js之类的文件缓存，大家不要混淆了两个不同的概念。
- 如果直接做了js的重定向，或者在服务端做了重定向，没有在link里面手动设置，是不起作用的。

这个对于什么样的网站更有作用呢，类似taobao这种网站，你的网页引用了大量很多其他域名的资源，如果你的网站，基本所有的资源都在你本域名下，那么这个基本没有什么作用。因为DNS Chrome在访问你的网站就帮你缓存了。

## dns解析原理，输入网址后如何查找服务器
